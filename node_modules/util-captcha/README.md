# util-captcha

node验证码模块，包含图片验证码和文字验证码，支持redis和session存储

## Getting Started
Install the module with: `npm install util-captcha`

+ 如果使用图片验证码，必须安装ghostscript imagemagick graphicsmagick.

```
osx: brew install ghostscript imagemagick graphicsmagick
linux: apt-get install ghostscript imagemagick graphicsmagick
```

+ 如果使用redis进行存储，请安装 `npm install redis`

## Documentation
验证码有以下2类:

+ 图片验证码，nodejs生成图片通过图片链接传输到web页面中，由用户输入图片中的文字通过http传输到nodejs，由nodejs来判断有效性
   
   ```
   var captcha = require('util-captcha'); //引入

   //生成图片方法一，存入session中，失效时间为30分钟 (**主要用在非rest的项目中**)
   router.get('/pic_cc', captcha.mid_pic_session(30));

   //生成图片方法二，存入redis中,失效时间30分钟，必须传入参数redis的client，以及唯一识别的key(比如手机号)
   //(**主要用在rest的项目，因为没有session**)
   router.get('/pic_cc', captcha.mid_pic_redis(client, key, 30));

   //生成图片方法三，采用非中间件的函数，直接调用生成图片的函数，自由决定如何存储信息 (**不建议使用，除非很了解如何保证时效性**)
   captcha.create_pic(text, writeStream, fn);

   //判断是否有效
   // client: 可以是redis的client或者req(取决于你生成图片采用的存储机制，比如保持一致)
   // value: 通过http传回来需要验证的值
   // type: 类型，如注册register
   // key: 如果是redis,需要传入识别字段，比如手机号，如果是session,就是null
   // fn:  如果是redis,需要传入回调函数, 回调函数的第二个参数就是是否验证通过的结果值，如果采用session，函数的返回值就是是否验证通过的结果值
   captcha.valid_pic(client, value, type, key, fn);
   ```

+ 文字验证码，主要是生成文字通过短信方式发送给用户，由用户输入短信验证码通过http传输到nodejs,由nodejs来判断有效性

  ```
  var captcha = require('util-captcha'); //引入

  //生成文字方法一，存入session中，失效时间为30分钟 (**主要用在非rest的项目中**)
  /**
   * @param  {Function} fn       回调函数，通常在里面进行短信发送，然后根据短信发送情况返回数据
   * @param  {Number}   len      短信数字的长度(默认为6)
   * @param  {Number}   expires  过期时间(默认为30分钟)
   * @param  {String}	_code    如果传入code，不再生成，只是存储到session
   */
  router.get('/text_cc', captcha.mid_text_session(fn, len, expires, _code));


  //生成文字方法二，存入redis中，失效时间为30分钟 (**主要用在rest的项目中**)
  /**
   * @param  {Function}      fn       回调函数，通常在里面进行短信发送，然后根据短信发送情况返回数据
   * @param  {redisClient}   client   redis客户端连接
   * @param  {String}        key      识别字段，比如手机号
   * @param  {Number}        len      短信数字的长度(默认为6)
   * @param  {Number}   	 expires  过期时间(默认为30分钟)
   * @param  {String}	  	 _code    如果传入code，不再生成，只是存储到redis
   */
  router.get('/text_cc', captcha.mid_text_redis(fn, client, key, len, expires, _code));

  //判断是否有效
  // client: 可以是redis的client或者req(取决于你生成图片采用的存储机制，比如保持一致)
  // value: 通过http传回来需要验证的值
  // type: 类型，如注册register
  // key: 如果是redis,需要传入识别字段，比如手机号，如果是session,就是null
  // fn:  如果是redis,需要传入回调函数, 回调函数的第二个参数就是是否验证通过的结果值，如果采用session，函数的返回值就是是否验证通过的结果值
  captcha.valid_text(client, value, type, key, fn);
  ```


## Examples
_(Coming soon)_

## Release History
_(Nothing yet)_

## License
Copyright (c) 2016 xiejun